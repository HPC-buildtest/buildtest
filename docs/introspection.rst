Introspection Operation
=========================

.. contents::
   :backlinks: none

List Options (``buildtest list --help``)
____________________________________________

.. program-output:: cat scripts/buildtest-list-help.txt


buildtest comes with a set of options for listing useful info such as

-  List Unique software

-  List software-modulefile relationship

-  List of easyconfigs


List Software (``buildtest list --software``)
---------------------------------------------------------------

buildtest can report the software list by running the following ``buildtest list --software`` or
short option ``buildtest list -s``


buildtest determines the software list based on the module trees specified in ``BUILDTEST_MODULEPATH``
and processes each module tree and returns a  unique software list

.. program-output:: cat scripts/buildtest-list-software.txt


Listing Modules (``buildtest list --modules``)
------------------------------------------------

If you want to view a breakdown of all modules then use ``buildtest list
--modules`` or short option ``buildtest list -m``

The output will be sorted by software and each entry will correspond to the full path of the modulefile.

.. program-output:: cat scripts/buildtest-list-software-modules.txt

.. _list_easyconfigs:

List easyconfigs from module trees (``buildtest list --easyconfigs``)
-------------------------------------------------------------------------

buildtest can return a list of easyconfigs from module trees defined in ``BUILDTEST_MODULEPATH``.
You can run ``buildtest list --easyconfigs`` or short option ``buildtest list -ec``.

buildtest will report full path to easyconfigs and also report any errors if it can't find
any easyconfig. If you specify a module tree that is not built by easybuild you can expect
some **warning** or **error** messages which is intended.

buildtest will attempt to search for any file with ``.eb`` extension  in ``easybuild`` directory
that is part of install directory of each software for every easybuild app.

.. program-output:: head -n 15 scripts/buildtest-list-easyconfigs.txt


If an easyconfig is not found you may get the following message

.. Error::

    Could not find easyconfig in /clust/app/easybuild/2018/IvyBridge/redhat/7.3/software/NWChem/6.8.revision47-intel-2018a-2017-12-14-Python-2.7.14/easybuild


Find Subcommands
_________________

Find Operations (``buildtest find --help``)
---------------------------------------------

.. program-output:: cat scripts/buildtest-find-help.txt

Find YAML configs (``buildtest find -fc``)
---------------------------------------------------------------

To find all yaml configuration use the option ``buildtest find --find-configs all`` or
short option ``buildtest find -fc all``



This will give you an output of all **.yml** files in $BUILDTEST_CONFIGS_REPO
that is used to configure on your test scripts.

.. program-output:: head -n 10 scripts/buildtest-find-configs.txt


Find test scripts (``buildtest find -ft``)
--------------------------------------------

To find all test scripts generated by buildtest you can run ``buildtest find --find-test all`` or
short option ``buildtest find -ft all``

This will report the full path to all tests currently generated by buildtest.

.. program-output:: head -n 10 scripts/buildtest-find-test.txt


Show Options (``buildtest show --help``)
_________________________________________

.. program-output:: cat scripts/buildtest-show-help.txt

Show Configuration (``buildtest show --config``)
-------------------------------------------------

buildtest can display it's configuration by running ``buildtest show --config``. The
configuration can be changed by the following:

 1. Command Line
 2. Environment Variable (``BUILDTEST_``)
 3. Configuration File (``settings.yml``)

buildtest will read configuration from ``settings.yml``. User may override any configuration
values by environment variables that start with ``BUILDTEST_``. The command line will
override environment variables and configuration variables runtime.

Shown below is a sample configuration from buildtest by running ``buildtest show --config``.


.. program-output:: cat scripts/buildtest-show-configuration.txt



``buildtest show --config`` will show the updated configuration if you set any ``BUILDTEST_*`` environment
variables.

For instance, if you want to override configuration BUILDTEST_SHELL shell to
``csh`` then ``buildtest show --config`` will report the overridden value denoted with **(E)** to indicate configuration was set
by environment variable.

See example below

.. code-block:: console
    :linenos:
    :emphasize-lines: 12

    $ BUILDTEST_SHELL=csh buildtest show -c
             buildtest configuration summary
             (C): Configuration File,  (E): Environment Variable
    BUILDTEST_BINARY                                   (C) = False
    BUILDTEST_CLEAN_BUILD                              (C) = False
    BUILDTEST_CONFIGS_REPO                             (C) = /home/ec2-user/PycharmProjects/buildtest-framework/toolkit
    BUILDTEST_LOGDIR                                   (C) = /tmp/ec2-user/buildtest/logs
    BUILDTEST_MODULEPATH                               (C) = /apps/modules/all
    BUILDTEST_MODULE_FORCE_PURGE                       (C) = False
    BUILDTEST_PARENT_MODULE_SEARCH                     (C) = first
    BUILDTEST_RUN_DIR                                  (C) = /tmp/ec2-user/buildtest/run
    BUILDTEST_SHELL                                    (E) = csh
    BUILDTEST_SPIDER_VIEW                              (C) = current
    BUILDTEST_SUCCESS_THRESHOLD                        (C) = 1.0
    BUILDTEST_TESTDIR                                  (C) = /tmp/ec2-user/buildtest/tests



.. Note:: if you plan to customize your buildtest configuration with configuration file
    and environment variable, always check your shell environment first to avoid having
    values overridden accidentally

.. _show_keys:

Show Keys
-----------

buildtest can show YAML keys based on testblock. Currently, there is one testblock
defined **singlesource**.

To show yaml keys you can run ``buildtest show -k singlesource`` to view all the YAML
keys that pertain to ``testblock: singlesource`` found in YAML files

.. program-output:: cat scripts/buildtest-show-key.txt

